---

# README: Система Обнаружения и Распознавания Лиц

## Обзор

Добро пожаловать в Систему Обнаружения и Распознавания Лиц! Этот проект использует техники компьютерного зрения для идентификации и распознавания лиц на изображениях. Включает функции выбора целевых лиц на основе различных критериев, таких как центральное положение, площадь и информация о глубине.

### Ключевые Возможности

- Определение живости лица.

## Требования

Перед тем как начать, убедитесь, что у вас установлено следующее программное обеспечение:

- Python 3.x
- Необходимые библиотеки (см. ниже)

### Необходимые Библиотеки

Вы можете установить необходимые библиотеки с помощью pip. Откройте интерфейс командной строки и выполните следующую команду:

```bash
pip3 install -r requirements.txt
```
---

## Описание имеющихся файлов и директорий

### AntiSpoof

Представляет из себя модуль для работы с моделью, способной определять живость лица. Имеется всего 1 файл - FaceAntiSpoofing.py, в котором и находится класс
предоставляющий инструменты для работы с моделью.

### Класс `AntiSpoof`

Класс `AntiSpoof` предоставляет возможность пользоваться предобученными моделями, представляющими из себя файлы с расширением '.onnx' (в них хранится
информация об архитектуре и весах модели).

#### Методы класса:

- `__init__(self, weights: str)`  
  Конструктор класса Инициализация объекта класса AntiSpoof и инициализация модели с помощью метода `_init_session`.
  - `weights` — Путь до модели в формате файла '.onnx'

- `_init_session_(self, onnx_model_path: str)`  
  Инициализация модели по определению живости лица, поданной в конструкторе.
  - `onnx_model_path` — self.weights. Путь до модели в формате файла '.onnx'
  - Возврат:
        object, str: объект для инференса модели, имя входного тензора

- `preprocessing(self, img)`  
  Предобработка входного изображения в модель
  - `img` — изображение, которое обязательно в формате numpy массива и с цветовым пространством RGB.
  - Возврат:
        np.array: предобработанное изображение

- `postprocessing(self, prediction: np.array)`  
  Метод постобработки предсказаний модели. Применяется ф-ция активации softmax для выходных значений классификатора.
  - `prediction` — выходные значения классификатора (модели по определению живости лица)
  - Возврат:
        list: список вероятносетй принадлежности изображения
            к определённому классу [настоящий, ненастоящий, ненастоящий]

- `__call__(self, imgs : list)`
  Метод вызова объекта класса, объединяет в себе всю работу модели c предобработкой и постобработкой.
  - `imgs` — список изображений, если одно, то задаётся [img]
  - Возврат:
        bool или list:
        bool: False, в случае если модель не сработает
        list: список предсказаний модели для каждого поданного изображения,
        где элемент с индексом [0][0] - вероятность, что на первом изображении
        настоящий человек и т.п.

- `increased_crop(img: np.array, bbox: tuple, bbox_inc: float = 1.5, marking='yolo')`  
  Статический метод для получения обрезанного лица с увеличенной областью.
  - `img` — исходное изображение для обрезки.
  - `bbox` — координаты ограничивающей рамки.
  - `bbox_inc` — коэффициет увеличения изображений относительно ограничивающей рамки.
  - `marking` — формат разметки, доступные 'coco', 'voc', 'yolo'. Разметка зависит от детектора, у которог берём координаты ограничивающей рамки.

### saved_models

Директория, содержащая в себе предобученные модели в формате '.onnx'

### Остальные файлы
- `detect_embedding.py`, `detector_Pluzhnikov.py`, `detector_stepanov.py`, `detector.py`, `Reznik.py`, `streams.py` - модули, представляющие из себя конечный проект, где `Reznik.py` - пример интеграции AntiSpoof системы в проект, который может быть интегрирован либо с `detector_stepanov.py`, либо `detector_Pluzhnikov.py`(в `Reznik.py` представлена интеграция с `detector_Pluzhnikov.py`)
- `requirements.txt` - необходимые библиотеки для работы AntiSpoof-системы ```pip3 install -r requirements.txt```

### класс `AntiSpoofSystem(Recognizer)` (из файла `Reznik.py`)

#### Методы класса:

- `__init__(self, spoof_model_path: str)`  
  Конструктор
  - `spoof_model_path` — Путь до модели в формате файла '.onnx'. По умолчанию:
  "saved_models/AntiSpoofing_bin_1.5_128.onnx"

- `useAlivePerson(self, spoof_threshold=0.6, frames_threshold=0.9, frame_count=10)`  
  инициализация порога или выключатель при `threshold=0`
  - `spoof_threshold` — порог [0;1]. инициализация модели и порога
  - `spoof_threshold` — порог [0;1]. пороговое отношение живых кадров к `frame_count`
  - `spoof_threshold` — количество кадров взятых для анализа.

- `setAlivePerson(self)`  
  вынос вердикта (настоящий/фальшивый)
  - Возврат:
    bool: окончательный вердикт.

- `checkAlivePerson(self, frame, bbox: tuple)`  
  работа модели (анализ каждого кадра на живость)
  - `frame` — кадр видеопотока
  - `bbox` — ограничивающая рамка лица

- `checkAlivePerson(self, frame, bbox: tuple)`  
  работа модели (анализ каждого кадра на живость)
  - `frame` — кадр видеопотока
  - `bbox` — ограничивающая рамка лица

## Начало Работы

1. **Клонирование Репозитория**: Если вы еще не сделали этого, клонируйте проект на свой локальный компьютер.

   ```bash
   git clone <URL-репозитория>
   cd <папка-репозитория>
   ```

## Заключение

Эта AntiSpoof Система предоставляет простой интерфейс для определения живости лица.
AntiSpoof может быть интегрирован в различные системы распознавания лиц для увелечения безопасности (для предотвращения обмана системы распознавания лиц с помощью фотографий или видео внесённого в базу сотрудника)